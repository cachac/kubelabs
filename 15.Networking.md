# 15. Networking <!-- omit in TOC -->

> [Ver los archivos demo](./kubelabs-files-demo)

> [Documentación Oficial](https://kubernetes.io/docs/concepts/cluster-administration/networking/)

## 1. Ingress Controller

> [Documentación Oficial](https://kubernetes.io/docs/concepts/services-networking/ingress/)
### 1.1. Crear un Ingress Controller utilizando el archivo

> [kubelabs-files-demo/ingress-definition.yml](./kubelabs-files-demo/ingress-definition.yml)

Validar la configuración

- rules
  - host
  - path
  - pathType: Prefix (/) ó Exact
  - backend: service name y port number
- service: name, ClusterIP, port
- deployment: template labels

```vim
kubectl apply -f kubelabs-files-demo/ingress-definition.yml
```

### 1.2. Validar resultados
```vim
kubectl get ingress http-ingress
```
Resultado:
> Hosts: kube1.kubelabs.tk ...
```
NAME           CLASS    HOSTS                                     ADDRESS     PORTS   AGE
http-ingress   public   kube1.kubelabs.tk,www.kube1.kubelabs.tk   127.0.0.1   80      63m
```

```vim
```
Resultado:
```yaml
Rules:
  Host                   Path  Backends
  ----                   ----  --------
  kube1.kubelabs.tk
                         /   svc-kube-1:80 (10.1.126.109:80,10.1.126.66:80,10.1.126.69:80 + 1 more...)
  www.kube1.kubelabs.tk
                         /   svc-kube-1:80 (10.1.126.109:80,10.1.126.66:80,10.1.126.69:80 + 1 more...)
```

```vim
kubectl describe svc svc-kube-1
```
Resultado:
```yaml
Port:              main  80/TCP
TargetPort:        80/TCP
Endpoints:         10.1.126.109:80,10.1.126.66:80,10.1.126.69:80 + 1 more...
```

### 1.3. Probar en browser

```vim
kube<n>.kubelabs.tk
```

### 1.3. Práctica: crear un ingres y service para la ruta /demo

> Utilizar de base el archivo ingress-definition.yml del punto anterior.

> Utilizar el archivo de configuración /15/default.conf

> [default.conf](./15/../kubelabs-files-demo/15/default.conf)

En la definición del Pod agregar el archivo default.conf en la ruta:

> /etc/nginx/conf.d/default.conf
> hostPath type: FileOrCreate
